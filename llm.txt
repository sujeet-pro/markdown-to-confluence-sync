# md2cf

> CLI tool and Node.js library to sync Markdown files to Confluence Cloud pages.

Full documentation: https://sujeet-pro.github.io/markdown-to-confluence-sync/
LLM-optimized reference: https://sujeet-pro.github.io/markdown-to-confluence-sync/llms-full.txt

## Quick Start

```bash
npm install -g md2cf
md2cf config                          # set email, token, baseUrl
md2cf ./doc.md <page-url>             # update a page
md2cf ./doc.md <space-url> --create   # create a page
md2cf read <page-url> --output p.md   # read a page as Markdown
```

## Commands

| Command | Description |
|---------|-------------|
| `md2cf <source> <url>` | Sync Markdown to Confluence (update or create) |
| `md2cf read <page-url>` | Read a Confluence page as Markdown |
| `md2cf init` | Scaffold a sample Markdown file |
| `md2cf config` | Manage credentials |

## Options

| Option | Description |
|--------|-------------|
| `-c, --create` | Create a new page |
| `--title <title>` | Override page title |
| `--strategy <s>` | Merge strategy: `local-wins` (default), `auto-merge`, `remote-wins`, `append` |
| `--dry-run` | Preview without making changes |
| `-y, --yes` | Skip confirmation prompts |
| `--skip-mermaid` | Skip mermaid rendering |
| `-o, --output <f>` | Write to file (read command) |

## Merge Strategies

| Strategy | Behavior |
|----------|----------|
| `local-wins` | Full replacement with local content (default) |
| `auto-merge` | Line-level merge, prefers local for conflicts |
| `remote-wins` | Keep remote content |
| `append` | Add local after remote, separated by `---` |

## Source Types

- Local file: `./doc.md`
- Local folder: `./docs/` (recursive sync)
- Remote URL: `https://raw.githubusercontent.com/.../doc.md`

## URL Formats

- Page: `https://domain.atlassian.net/wiki/spaces/SPACE/pages/12345`
- Space: `https://domain.atlassian.net/wiki/spaces/SPACE`

## Supported Markdown

Headings, bold, italic, strikethrough, code blocks, lists, tables, links, images, blockquotes, horizontal rules, TOC sections, mermaid diagrams, panels (`> [!NOTE]`, `> [!TIP]`, `> [!IMPORTANT]`, `> [!WARNING]`, `> [!CAUTION]`), expand/collapse (`:::expand Title ... :::`).

Avoid: raw HTML, task lists, footnotes, definition lists, complex tables, reference-style links.

## Title Resolution

1. `--title` flag (if provided)
2. First `# H1` heading in the Markdown
3. Filename converted to title case

## Primary Agent Workflow

```bash
# 1. Read
md2cf read <page-url> --output page.md
# 2. Modify page.md
# 3. Write back
md2cf page.md <page-url> --strategy auto-merge --yes
```

## Library API

```javascript
import { ConfluenceClient, convertMarkdownToAdf, adfToMarkdown, mergeMarkdown } from "md2cf";
```

Key exports: `ConfluenceClient`, `convertMarkdownToAdf`, `adfToMarkdown`, `readMarkdownSource`, `mergeMarkdown`, `parseConfluenceUrl`, `extractTitle`, `titleFromFilename`.

## Configuration

Stored at `~/.md2cf/config.json`. Required fields: `email`, `token`, `baseUrl`.

```bash
md2cf config set email user@company.com
md2cf config set token YOUR_API_TOKEN
md2cf config set baseUrl https://company.atlassian.net
```

## License

MIT
